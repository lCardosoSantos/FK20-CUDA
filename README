 # FK20 project


## Luan's todolist
Here in this section I keep track of the activities I am working on. Meaningful indentation
Last update: 20230721

- Improvements in the code base:
  - [ ]  Documentation
    - [ ]  Check with DF if he want us to follow any specific standard from the ETH foundation. Maybe Doxygen?
  - [ ]  Implement a CRC check on the KAT data before and after every test.
  - [ ]  512row: Move KATs to a dinamic lib
  - [x]  ~~Benchmark: Implement a separate benchmark with GPU spool-up.~~ 20230721
  - [x]  ~~Implement false-positive checks~~ 20230718
  - [x]  ~~Test 512row with prefiled memory patterns~~ 20230706: no new test failures.
- Debug:
  - [?] Update test_rand. Probably not necessary, since 512 now covers it
  - [?] fk20_hext_fft2h_fft: hext_fft -> h_fft: breaks after the math update, tmp-reg is zerod (?)
  - [x] ~~Update the 512row tests with modifications from the single row test~~
  - [x] ~~>>>> fk20_poly2h_fft_515 (full fk20 execution, currently host)~~
    - [x] ~~cuda error 700~~ 20230707
    - [x] Error with memory pattern on tmp variables. *Only on g1p*
  - [x] ~~g1p_ifft:279 thread 255 breaks by zeroing `g1p_tmp[r]``~~ 20230713
  - [x] ~~g1p inverted fft doesnt pass tests (Dag here) ~~(but ift(fft(x))=>x)~~ 20230713
    - [ ] Remove shared memory from fft?
  - [x] ~~hext_fft2h_fft_512: cuda error 700~~
  - [x] ~~fk20_msmloop_512: cuda error 700~~
  - [x] ~~fk20_poly2toeplitz_coefficients_fft_512: cuda error 700~~ Unecessary function 202307123
  - [x] ~~fk20_poly2hext_fft_512: ~~ 20230712
    - [x] ~~cuda error 700~~
    - [x] ~~Fails KAT. Compare memory dumps of two blocks with same KAT?~~
    - ~~note: Check with DA/DF if all the rows being fk20 over the same setup is an actual characteristic of the implementation. Will have impact on memory allocations if different setups.~~ By default, same setup across rows.
  - [x] ~~Fix of g1pComparen with Null non-point parameter~~ 20230710: Come back here for more robust solution
  - [x] ~~g1p_mul ispoint test works as expected?~~ 20230711
  - [x] ~~fk20_poly2toeplitz_coefficients_fft: unknown cuda error 700~~ 20230711
  - [x] ~~fk20_poly2toeplitz_coefficients_512: not passing test~~ 20230706


# Debug notes

## next day work:

go back to fk20test_poly and write a function to do the msmloop on two identical tests, with 2 blocks, and go from there.

Break example from g1p_ift
```
      (cuda-gdb) p/x fr_roots[513+w]
      $41 = {0xffffff7f00000001, 0xeb47a282fec35a7e, 0x32f32f21a266d682, 0x73eda753299d7d48}

      (cuda-gdb) p/x g1p_tmp[r]
      $42 = {x = {0xcff7fffffffd5558, 0xf55ffff58a9ffffd, 0x39869507b587b120, 0x23ba5c279c2895fb, 0x58dd3db21a5d66bb, 0xd0088f51cbff34d2}, 
             y = {0x852a0d540e58f3b2, 0xcd46b3d7c6725d4e, 0xf33e17b9bebb1337, 0x77abc9ffe23256b2, 0x5ea086d114a75ccf, 0xae5885851b99b72}, 
             z = {0xb9feffffffffaaab, 0x1eabfffeb153ffff, 0x6730d2a0f6b0f624, 0x64774b84f38512bf, 0x4b1ba7b6434bacd7, 0x1a0111ea397fe69a}
            }

      g1p_mul(g1p_tmp[r], fr_roots[513+w]);  // w ? 2**-9/fr_roots[128] : 2**-9
```


Return to fk20_hext_fft2h_fft >> one of the fft zeros stuff

## Last run of fk20test
```
    ./fk20test
    === RUN   fr_fft: toeplitz_coefficients -> toeplitz_coefficients_fft
    (0.006 s)
    --- PASS
    === RUN   g1p_fft: h -> h_fft
    (4.386 s)
    --- PASS
    === RUN   g1p_ift: h_fft -> h
    (5.020 s)
    cmp ->  255--- FAIL
    === RUN   g1p_ift: hext_fft -> h
    (5.388 s)
    IFT error 255
    --- FAIL
    === RUN   fk20_hext_fft2h_fft: hext_fft -> h_fft
    g1p_tmp[0]:0000000000000000 0000000000000000 0000000000000000 0000000000000000 0000000000000000 0000000000000000 
    0000000000000000 0000000000000000 0000000000000000 0000000000000000 0000000000000000 0000000000000000 
    0000000000000000 0000000000000000 0000000000000000 0000000000000000 0000000000000000 0000000000000000 
    hext_fft[0]:22392725836fe87a ef97444ae3e772e0 b9f8787cae23d734 e3165f2c5a9a2e2c 1f3c96f14015e68c 0e1483fb668693f3 
    a938c69c88ed7e61 fed9c764daa5a82b 1b3e8638125aab02 604dd6b302c8f8a6 c71af68d04fb6941 0d34cfaad7594404 
    274118a6c058426e 2134bdf3ffd0e222 0281311be8e1aef3 3a88e85d7b920444 61242af0838f4e5d 06c23ecdf6aeda7c 
    (8.728 s)
    fk20_hext_fft2h_fft error at idx 0
    --- FAIL
    >>>> Poly Tests
    === RUN   fk20_poly2toeplitz_coefficients: polynomial -> toeplitz_coefficients
    (0.000 s)
    --- PASS
    === RUN   fk20_poly2hext_fft: polynomial -> hext_fft
    (19.172 s)
    --- PASS
    === RUN   fk20_msm: Toeplitz_coefficients+xext_fft -> hext_fft
    (18.578 s)
    --- PASS

    >>>>FullTest
    polynomial -> tc
    --- PASS
    tc -> tc_fft
    --- PASS
    tc_fft -> hext_fft
    --- PASS
    hext_fft -> hext -> h
    --- FAIL
    h -> h_fft
    --- PASS
```

Slow, why? commit fd0aa97b16fe0667b5856da5983fdf022976f0d0 is fast!